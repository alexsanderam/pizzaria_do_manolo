package dominio;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Collection;

import excecoes.ExcecaoDeItemPedido;
import excecoes.ExcecaoDePedido;

public class Pedido {

	private Integer id;
	private Cliente cliente;
	private Timestamp dataHora;
	private Collection<ItemPedido> itens;
	
	private Pedido(Cliente cliente){
		this.id = null;
		this.cliente = cliente;
		this.dataHora = null;
		this.itens = new ArrayList<ItemPedido>();
	}
	
	public static Pedido novoPedido(Cliente cliente) throws ExcecaoDePedido{
		validarDados(cliente);
		
		return new Pedido(cliente);
	}
	
	public void incluirPizza(Pizza pizza, Integer quantidade) throws ExcecaoDeItemPedido{
		ItemPedido novoItem = ItemPedido.criarItemPedido(this, pizza, quantidade);
		this.itens.add(novoItem);
	}
	
	public void removerItem(ItemPedido itemPedido) throws ExcecaoDePedido{
		validarItemPedido(itemPedido);
		this.itens.remove(itemPedido);
	}
	
	
	
	public Float obterValorTotal(){
		Float valorTotal = 0f;
		
		for (ItemPedido itemPedido : itens) {
			valorTotal += itemPedido.obterSubtotal();
		}
		
		return valorTotal;
	}
	
	private static void validarDados(Cliente cliente) throws ExcecaoDePedido{
		validarCliente(cliente);
	}
	
	private static void validarCliente(Cliente cliente) throws ExcecaoDePedido{
		if(cliente == null)
			throw new ExcecaoDePedido("pedido.cliente.invalido");
	}
	
	private static void validarDataHora(Timestamp dataHora) throws ExcecaoDePedido{
		if(dataHora == null)
			throw new ExcecaoDePedido("pedido.data_hora.invalida");
	}
	
	private static void validarId(Integer id) throws ExcecaoDePedido{
		if(id == null || id <= 0)
			throw new ExcecaoDePedido("pedido.id.invalido");
	}
	
	private static void validarItemPedido(ItemPedido itemPedido) throws ExcecaoDePedido{
		if(itemPedido == null)
			throw new ExcecaoDePedido("pedido.itempedido.invalido");
		
	}
	
	public Integer obterId(){
		return this.id;
	}
	
	public void definirId(Integer id) throws ExcecaoDePedido{
		validarId(id);
		this.id = id;
	}

	public Cliente obterCliente() {
		return cliente;
	}

	public void definirCliente(Cliente cliente) throws ExcecaoDePedido {
		validarCliente(cliente);
		this.cliente = cliente;
	}

	public Timestamp obterDataHora() {
		return this.dataHora;
	}
	
	public void definirDataHora(Timestamp dataHora) throws ExcecaoDePedido{
		validarDataHora(dataHora);
		this.dataHora = dataHora;
	}

}
